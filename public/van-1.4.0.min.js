let t,e,r,o,l,s=Object,n=s.getPrototypeOf,f=document,i={isConnected:1},h={},a=n(i),_=n(n),d=(t,e,r,o)=>(t??(setTimeout(r,o),new Set)).add(e),u=(t,e,o)=>{let l=r;r=e;try{return t(o)}catch(t){return console.error(t),o}finally{r=l}},w=t=>t.filter(t=>t.t?.isConnected),g=e=>l=d(l,e,()=>{for(let t of l)t.o=w(t.o),t.l=w(t.l);l=t},1e3),S={get val(){return r?.i?.add(this),this.h},get oldVal(){return r?.i?.add(this),this._},set val(o){if(r?.u?.add(this),o!==this.h){this.h=o;let r=[...this.l=w(this.l)];for(let e of r)y(e.f,e.s,e.t),e.t=t;this.o.length?e=d(e,this,V):this._=o}}},c=t=>({__proto__:S,h:t,_:t,o:[],l:[]}),v=(t,e)=>{let r={i:new Set,u:new Set},l={f:t},s=o;o=[];let n=u(t,r,e);n=(n??f).nodeType?n:new Text(n);for(let t of r.i)r.u.has(t)||(g(t),t.o.push(l));for(let t of o)t.t=n;return o=s,l.t=n},y=(t,e=c(),r)=>{let l={i:new Set,u:new Set},s={f:t,s:e};s.t=r??o?.push(s)??i,e.val=u(t,l,e.h);for(let t of l.i)l.u.has(t)||(g(t),t.l.push(s));return e},x=(e,...r)=>{for(let o of r.flat(1/0)){let r=n(o??0),l=r===S?v(()=>o.val):r===_?v(o):o;l!=t&&e.append(l)}return e},b=(e,r,...o)=>{let[l,...i]=n(o[0]??0)===a?o:[{},...o],d=e?f.createElementNS(e,r):f.createElement(r);for(let[e,o]of s.entries(l)){let l=r=>r?s.getOwnPropertyDescriptor(r,e)??l(n(r)):t,f=r+","+e,i=h[f]??(h[f]=l(n(d))?.set??0),a=e.startsWith("on")?(t,r)=>{let o=e.slice(2);d.removeEventListener(o,r),d.addEventListener(o,t)}:i?i.bind(d):d.setAttribute.bind(d,e),u=n(o??0);e.startsWith("on")||u===_&&(o=y(o),u=S),u===S?v(()=>(a(o.val,o._),d)):a(o)}return x(d,...i)},m=t=>({get:(e,r)=>b.bind(void 0,t,r)}),p=t=>new Proxy(b,m(t)),P=new Proxy(p,m()),T=(t,e)=>e?e!==t&&t.replaceWith(e):t.remove(),V=()=>{let r=[...e].filter(t=>t.h!==t._);e=t;for(let e of new Set(r.flatMap(t=>t.o=w(t.o))))T(e.t,v(e.f,e.t)),e.t=t;for(let t of r)t._=t.h};export default{add:x,tags:P,tagsNS:p,state:c,derive:y,hydrate:(t,e)=>T(t,v(e,t))};